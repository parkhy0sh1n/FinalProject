<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/layout/header::headFrag('Main')}"></head>
<link rel="stylesheet" href="/css/classDetail.css" />

<script th:inline="javascript">
   // ê¸°ë³¸ê°’ìœ¼ë¡œ ìƒì„¸ë³´ê¸° íƒ­ ì„ íƒ
   $(document).ready(function() {
      openTab('detail');
   });
   
   // íƒ­ ì—´ê³  ë‹«ê¸°
   function openTab(tabName) {
        if (tabName === 'review') {
            loadReviewTabContent();
        }
        $('.tabs button').removeClass('active');
        $('#' + tabName + 'Btn').addClass('active');
        $('.tab-content').hide();
        $('#' + tabName).show();
    }

   function openTab(tabName) {
       if (tabName === 'review') {
           // Make an AJAX request to retrieve the review content
           $.ajax({
               url: '/review/list?classNo=[[${imgClass.classNo}]]',
               type: 'GET',
               success: function(response) {
                   // Replace the content of the review tab with the retrieved reviewList HTML
                   $('#review').html(response);
               },
               error: function(error) {
                   console.error('Error loading review content:', error);
               }
           });
       }
       $('.tabs button').removeClass('active');
       $('#' + tabName + 'Btn').addClass('active');
       $('.tab-content').hide();
       $('#' + tabName).show();
   }

   $(function() {      
      var categoryName = /*[[${imgClass.classCategory}]]*/ null;
      function categoryChange() {
         if(categoryName == 'cooking' ) {
            $('.categoryName').text('ìš”ë¦¬/ë² ì´í‚¹');
         }else if(categoryName == 'fitness' ){
            $('.categoryName').text('í”¼íŠ¸ë‹ˆìŠ¤/ìŠ¤í¬ì¸ ');
         }else if(categoryName == 'study' ){
            $('.categoryName').text('ê°œë°œ/ê³µë¶€');
         }else if(categoryName == 'dance' ){
            $('.categoryName').text('ëŒ„ìŠ¤');
         }else if(categoryName == 'design' ){
            $('.categoryName').text('ë””ìì¸');
         }
      }
      
      
   function fnEnroll() {
    let classNo = /*[[${classNo}]]*/ null;
    location.href='/enroll/apply.page?classNo=' + classNo;
    }
   
   
   // í•¨ìˆ˜í˜¸ì¶œ
   categoryChange();
   })
   
   // ë©”ì‹œì§€ì°½ íŒì—…    ì—´ê¸°
   function openMessage() {
       // íŒì—… ì°½ì„ ì—´ê¸° ìœ„í•œ ì„¤ì •
       var popupWidth = 500;
       var popupHeight = 800;
       var left = (screen.width - popupWidth) / 2;
       var top = (screen.height - popupHeight) / 2;
       var popupOptions = 'width=' + popupWidth + ', height=' + popupHeight + ', left=' + left + ', top=' + top;
       // íŒì—… ì°½ì„ ì—´ê³  í•´ë‹¹ HTML í˜ì´ì§€ë¥¼ ë¡œë“œ
       window.open('/chat/list2', 'ë©”ì‹œì§€', popupOptions);
   }
   
   function fnEnroll() {
         let classNo = /*[[${classNo}]]*/ null;
         location.href='/enroll/apply.page?classNo=' + classNo;
      }
   
</script>

<body>
   <div th:replace="~{/layout/header::gnbFrag}"></div>
  
   <div id="all">
      <div id="detailMain">
         <!-- <div id="category">
            <span>ì¹´í…Œê³ ë¦¬ [</span><span class="categoryName"></span><span>]</span>
         </div> -->
      <ul id="text">
         <li>ì›ë°ì´Â· </li>
         <li th:text="${imgClass.classArea}"></li>
         <li>Â· ìµœëŒ€ 6ëª…</li>
      </ul>
         <h1 th:text="${imgClass.classTitle}"></h1>
         <ul id="profile">
              <li class="profile-container">
            <div class="left-section">
               <!-- íšŒì› í”„ë¡œí•„ì‚¬ì§„ ê°€ì ¸ì˜¤ê¸°(0ì´ë©´ ê¸°ë³¸ í”„ë¡œí•„ ì‚¬ì§„, 1ì´ë©´ íšŒì›ì´ ë“±ë¡í•œ í”„ë¡œí•„ ì‚¬ì§„) -->
               <div class="profile-image">
                   <img id="images1" src="https://s3.ap-northeast-2.amazonaws.com/taling.me/Content/Uploads/Profile/s_15db7d017ca94ded79119b94b46d8e2b9d4873d4.jpg" alt="Profile Image">
               </div>
                 </div>
               <div class="right-section">
                  <!-- íšŒì› ì •ë³´ -->
                  <div class="profile-info">
                     <!-- íšŒì› ë‹‰ë„¤ì„ ê°€ì ¸ì˜¤ê¸° (userName + íŠœí„°) -->
                         <p class="userName">ì–´ì¸ë¸”ë¦¬ìŠ¤ íŠœí„°</p>
                     <!-- í´ë˜ìŠ¤ í‰ì  í‰ê· ê³¼ ë¦¬ë·° ìˆ˜ ê°€ì ¸ì˜¤ê¸° -->
                     <span class="rating">
                        <span class="star">â˜…</span>
                        <span class="rating-info">&nbsp;5.0(7)</span>
                     </span>
                  </div>
                  </div>
            </li>
         </ul>
      <div id="imgMain">
         <th:block th:if="${imgClass.classNo <= 50}">
            <img th:src="${imgClass.classMainPath}" width="700px;" height="500px;">
        </th:block>
        <th:block th:if="${imgClass.classNo > 50}">
            <img th:src="@{/class/display.do(classNo=${imgClass.classNo})}" width="700px;" height="500px;">
        </th:block>
      </div>
      </div>
      
      <!-- ìŠ¤ì¼€ì¤„ -->
      <div id="scjMain">
         <div id="scjsub">
              <h2 id="classScj">&nbsp;&nbsp;í´ë˜ìŠ¤ ì¼ì •</h2>
              <ul id="class-info">
                 <th:block th:each="sch,vs:${scheduleList}">
                 <th:block th:if="${sch.schState != 2}">
                   <li class="schduleList">
                      <div th:text="|ğŸŒº&nbsp;&nbsp;${#dates.format(sch.schStart,'yyyyë…„ Mì›” dì¼ Hì‹œ')} |" class="schStart"></div>
                        <div class="block">
                           <span th:text="|&nbsp;(${sch.schNowNum}|"></span>
                           <span th:text="| /${sch.schMaxNum}ëª…) |" class="schNum"></span>
                           <th:block th:if="${sch.schState == 0}">
                             <span class="unavailable">ë§ˆê°</span>
                          </th:block>
                          <th:block th:if="${sch.schState == 1}">
                              <span class="available">ê°€ëŠ¥</span>
                          </th:block>
                        </div>
                   </li>
               </th:block>
               <th:block th:if="${sch.schState == 2}">
                   <li class="scheduleArray">
                  <span class="undefined">ğŸŒº&nbsp;&nbsp;ì‘ê°€ë‹˜ê³¼ í˜‘ì˜ í›„ ê²°ì •</span>
                   </li>
               </th:block>
                 </th:block>
              </ul>
              
            <div th:object="${classList}" id="applyClass">
              <p id="moneyTime">
                 <span th:text="|ì´ *{classMoney} / |"></span>
                 <span th:text="*{classTime}" id="classTime"></span>
              </p>
              <ul id="heartClass">
                 <li id="heart">
                    <input type="hidden" class="classNo" th:value="${imgClass.classNo}">
	                   <img th:id="${imgClass.classNo}" class="wish" style="cursor:pointer;" th:src="@{/images/classList/heart/heart2.png}" onclick="fnWishAdd(this)">   
                </li>
                <li>
                    <a id="class" onclick="fnEnroll()">í´ë˜ìŠ¤ ì‹ ì²­í•˜ê¸°</a>
                </li>
              </ul>
            </div>
              <ul id="chattingMain">
                 <li>
                    <button id="chatting" onclick="openMessage()">
                       <img id="chat" th:src="@{/images/classList/heart/chat.png}">
                       íŠœí„°ì—ê²Œ ë¬¸ì˜í•˜ê¸°
                    </button>
                    
                 </li>
              </ul>
           </div>
      </div>
   </div>
   <script th:inline="javascript">
               var wishList = /*[[${wishList}]]*/ null;
               console.log(wishList);
               function chkWish() {
                  for(let i=0; i < wishList.length; i++) {
                     console.log(wishList[i]);
                     $('#' + wishList[i]).attr('src', '/images/classList/heart/heart1.png');
                  }
               }
               chkWish();
            
               function fnWishAdd(vThis){
                  
                  $.ajax({
                     // ìš”ì²­
                     type: 'get',
                     url: '/wish/wish.do',
                     data: 'classNo=' + $(vThis).siblings('.classNo').val(),
                     // ì‘ë‹µ
                     dataType: 'json',
                     success: function(resData){
                        if(resData.insertResult == 1){
                           alert('ì°œ ë“±ë¡ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                           $(vThis).attr('src', '/images/classList/heart/heart1.png');
                        }else if(resData.removeResult == 1){
                           alert('ì°œ ë“±ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                           $(vThis).attr('src', '/images/classList/heart/heart2.png');
                        }
                     
                     }
                     
                  })
                  
               }
               
               
               
               // í•¨ìˆ˜í˜¸ì¶œ
                        
            </script>
      
      
    <div class="tabs">
        <button onclick="openTab('detail')" id="detailBtn">CLASS</button>
        <button onclick="openTab('review')" id="reviewBtn">REVIEW</button>
    </div>
     <!-- í´ë˜ìŠ¤ ì†Œê°œ íƒ­ -->
    <div id="detail" class="tab-content">
       <th:block th:if="${imgClass.classNo <= 50}">
           <img th:src="${imgClass.classDetailPath}" width="1100px;" height="4300px;">
      </th:block>
      <th:block th:if="${imgClass.classNo > 50}">
           <img th:src="@{/class/displayDetail.do(classNo=${imgClass.classNo})}" width="1100px;" height="4300px;">
      </th:block>
     </div>
    <!-- ë¦¬ë·° íƒ­ -->
    <div id="review" class="tab-content"></div>
    <div th:replace="~{/layout/footer::footerFrag}"></div>
</body>
</html>