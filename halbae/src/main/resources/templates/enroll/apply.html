<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/layout/header::headFrag('Apply Form')}"></head>
<link rel="stylesheet" th:href="@{/css/apply.css(ver=1.0)}">


<script th:inline="javascript">

	$(function(){
		printStar();
		fnList();
		
		$('.radioCheck').on('click', function(event){
			let nowNum = $(this).parent().find('#nowNum').val();
			let maxNum = $(this).parent().find('#maxNum').val();
			$('#resultNowNum').val(nowNum);
			$('#resultMaxNum').val(maxNum);
		})
		
		/* ìŠ¤ì¼€ì¤„ ì„ íƒ X */
		$('#btn_next').click(function() {
			var enrollPerson = parseInt($('#enrollPerson').val());
			var okPerson = parseInt($('#resultMaxNum').val()) - parseInt($('#resultNowNum').val());
			if (enrollPerson > okPerson) {
				console.log(enrollPerson, okPerson);
				alert('ì‹ ì²­í•˜ì‹  ì¸ì› ìˆ˜ëŠ” ì •ì› ì´ˆê³¼ì…ë‹ˆë‹¤.');
				event.preventDefault();
			    return;
			}
			if ($('.radioCheck:checked').length == 0) {
				alert('ìŠ¤ì¼€ì¤„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
				event.preventDefault();
			    return;
			}
			$('#frm').submit();
		});
		
	}) // function

	/* í‰ì  */
	function printStar() {
		let grade = /*[[${classList.classGrade}]]*/ null;
		for(let i=0; i< grade; i++) {
			$('#star').append('<i class="fa-solid fa-star" style="color: #f4575f;"></i>');
		}
	}
	
	/* ë§ˆê° í´ë˜ìŠ¤ í´ë¦­ ì‹œ */
	function fnList() {
		$('.radioCheck').on('click', function(event){
			let state = $(this).parent().find('.stateCheck').val();
			if(state === "0") {
				alert('í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ˜¥');
				$(this).parent().find('.radioCheck').prop('checked', false);
				return;
			}
		})
	}
	
	/* ì¸ì› + - ë°•ìŠ¤ */
	function fnNum(element) {
		let enrollPerson = parseInt($('#enrollPerson').val());
		let maxNum = parseInt($('#resultMaxNum').val());
		let nowNum = parseInt($('#resultNowNum').val());
		if (element.id == 'btn_minus' && enrollPerson > 1) {
			$('#enrollPerson').val(enrollPerson - 1);
		} else if(element.id == 'btn_plus' & enrollPerson < maxNum) {
			$('#enrollPerson').val(parseInt($('#enrollPerson').val()) + 1);
		}
	}
	
	/* íšŒì› ID í†µí•´ ì—°ë½ì²˜ í‘œì‹œ */
	$(document).ready(function() {
		$.ajax({
			type: 'get',
			url: '/enroll/user.do',
			data: 'userNo=' + $('#userNo').val(),
			dataType: 'json',
			success: function(resData) {
				var userTel = resData.userTel;
				var format = userTel.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
				$('#userTel').val(format);
			}
		});
	});
	

</script>

<body>

<!-- ìˆ¨ê²¨ì§„ íŒŒë¼ë¯¸í„°-->
<input type="hidden" value="" id="resultNowNum">
<input type="hidden" value="" id="resultMaxNum">

<div th:replace="~{/layout/header::gnbFrag}"></div>
	<div id="main_wrap">
  		<div id="enroll_title">ê°•ì˜ì‹ ì²­</div>
  		<form method="post" action="/enroll/apply.do" id="frm">
  			<div id="main_box">
		  		<div id="main_L">
					<div th:object="${classList}" id="applyClass">
  					<!--/* ì „ë‹¬ìš© : classNo */-->
  					<input type="hidden" name="classNo" th:value="*{classNo}">
						<img th:src="*{classMainPath}" width="250px" id="classImage">
						<div>
				  			<div th:text="*{classTitle}" id="classTitle"></div>
				  			<div id="classinfo">
				  				<div th:text="|*{classTime} ìˆ˜ì—…|" id="classTime"></div>
				  				<div th:text="*{classArea}" id="classArea"></div>
				  			</div>
			  				<span id="star"></span><span th:text="*{classGrade}"></span>
						</div>
					</div>
					<!--/* íŒŒë¼ë¯¸í„°1 : userNo */-->
					<input type="hidden" id="userNo" name="userNo" th:value="${session.userNo}">
					<div id="sch">í˜„ì¬ ì˜ˆì •ë˜ì–´ ìˆëŠ” ìˆ˜ì—…ì´ì—ìš”.</div>
					<div id="schList">
					<ul class="scheduleArray">
					
					<th:block th:each="sch,vs:${scheduleList}">
						<th:block th:if="${sch.schState != 2}">
							<li class="schduleList">
								<!--/* íŒŒë¼ë¯¸í„°2 : schNo */--> 
								<input type="radio" th:id="|inp_radio${vs.index}|" name="schNo" th:value="${sch.schNo}" class="radioCheck">
								<label th:for="|inp_radio${vs.index}|">
									<span th:text="${#dates.format(sch.schStart,'yyyyë…„ Mì›” dì¼ Hì‹œ')}" class="schStart"></span>
									<span class="block">
									
									<!-- hidden í˜„ì¬ì¸ì› -->
										<input type="hidden" th:value="${sch.schNowNum}" id="nowNum">
										<span th:text="| (${sch.schNowNum}|"></span>
									<!-- hidden ìµœëŒ€ì¸ì› -->
										<input type="hidden" th:value="${sch.schMaxNum}" id="maxNum">
										<span th:text="| /${sch.schMaxNum}ëª…) |" class="schNum"></span>
					 					
					 					<th:block th:if="${sch.schState == 0}">
					 						<input type="hidden" class="stateCheck" value="0">
											<span class="unavailable">ë§ˆê°</span>
										</th:block>
										<th:block th:if="${sch.schState == 1}">
					 						<input type="hidden" class="stateCheck" value="1">
											<span class="available">ê°€ëŠ¥</span>
										</th:block>
									</span>
								</label>
							</li>
						</th:block>
						<th:block th:if="${sch.schState == 2}">
							<li class="scheduleArray">
							<input type="radio" th:id="|inp_radio${vs.index}|" name="schNo" th:value="${sch.schNo}" class="radioCheck">
								<label th:for="|inp_radio${vs.index}|">
									<span class="undefined">ì‘ê°€ë‹˜ê³¼ í˜‘ì˜ í›„ ê²°ì •í• ê²Œìš” :)</span>
									<!-- hidden -->
										<input type="hidden" th:value="1" id="nowNum">
										<input type="hidden" th:value="10" id="maxNum">
								</label>
							</li>
						</th:block>
					</th:block>
							

						</ul>
					</div>
		  		</div>
		  		
		  		<div id="main_R" >
		  			<table id="tb_apply">
		  				<tbody>
		  					<tr id="tr_first">
		  						<td id="num_Title">ì‹ ì²­ ì¸ì›</td>
		  						
		  						<td id="boxNum">
		  							<button type="button" id="btn_minus" onclick="fnNum(this)"></button>
		  							<!--/* íŒŒë¼ë¯¸í„°3 : enrollPerson */--> 
					  				<input type="text" value="1" name="enrollPerson" id="enrollPerson">
					  				<button type="button" id="btn_plus" onclick="fnNum(this)"></button>
		  						</td>
		  					
		  					</tr>
		  					<tr id="tr_second">
		  						<td id="phoneNumber">ì—°ë½ì²˜</td>
		  						<td id="boxTel"><input type="text" disabled="disabled" id="userTel" style="height: 30px;"></td>
		  					</tr>
		  					<tr id="tbtr">
		  						<td id="toTuter" colspan="2">íŠœí„°ì—ê²Œ ì „ë‹¬í•˜ê³  ì‹¶ì–´ìš”!</td>
		  					</tr>
		  					<tr>
		  						<td colspan="2">
		  							<div id="toTuterBox">
		  								<!--/* íŒŒë¼ë¯¸í„°4 : enrollRequest */--> 
		  								<textarea name="enrollRequest" rows="8" cols="40" placeholder="ê²½í—˜ ìœ ë¬´ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ íŠœí„°ë‹˜ì˜ í´ë˜ìŠ¤ ì¤€ë¹„ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤ :) ê·¸ ì™¸ í•˜ê³  ì‹¶ì€ ë§ì´ ìˆë‹¤ë©´ ë‚¨ê²¨ì£¼ì„¸ìš”!"></textarea>
		  							</div>
		  						</td>
		  					</tr>
		  				</tbody>
		  			</table>
		  			<div>
		  				<button type="button" id="btn_next">ë‹¤ìŒ</button>
		  			</div>
		  		</div>
		  	</div>
  		</form>
  	</div>
<div th:replace="~{/layout/footer::footerFrag}"></div>
</body>
</html>